<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.koscom.batch.memo.mapper.MemoMapper">
	<select id="getMemoPushInfo" resultType="com.koscom.batch.memo.domain.MemoPushInfo">
		SELECT
			PI.NO_PERSON,
			PI.YN_OS,
			PI.CD_PUSH,
			PI.FCM_TOKEN,
			MI.MEMO_TEXT
		FROM PERSON_INFO PI, MEMO_INFO MI
			WHERE PI.NO_PERSON = MI.NO_PERSON
			AND MI.ALARM_DATE = TO_CHAR(SYSDATE,'YYYYMMDD')
			AND MI.ALARM_TIME = TO_CHAR(SYSDATE,'HH24MI')
	</select>
<!-- 히스토리성 푸시 정보 등록 -->
	<insert id="createPushEachInfo" parameterType="com.koscom.batch.memo.domain.MemoPushInfo">
		<selectKey keyProperty="seq_push" resultType="int" order="BEFORE">
			(SELECT NVL(MAX(seq_push),0)+1 FROM push_each_info)
		</selectKey>
		/* com.koscom.batch.memo.mapper.MemoMapper.createPushEachInfo: 푸시 등록 */
		INSERT INTO PUSH_EACH_INFO (
			  SEQ_PUSH
			, NO_PERSON
			, TITLE
			, BODY
			, PUSH_DIVCD
			, LINK_ADDR
			, YN_SEND
            , YN_DISPLAY
			, DT_RESERV
			, ID_FRT
			, DT_FRT
			, ID_LST
			, DT_LST
			)
		VALUES (
			  #{seq_push}
			, #{no_person, jdbcType=VARCHAR}
			, #{title, jdbcType=VARCHAR}
			, #{body, jdbcType=VARCHAR}
			, #{push_divcd, jdbcType=VARCHAR}
			, #{link_addr, jdbcType=VARCHAR}
			, NVL(#{yn_send   , jdbcType=VARCHAR}, 'Y')
		    , NVL(#{yn_display, jdbcType=VARCHAR}, 'Y')
			, SYSDATE
			, #{id_frt, jdbcType=VARCHAR}
			, SYSDATE
			, #{id_lst, jdbcType=VARCHAR}
			, SYSDATE
			)
	</insert>
</mapper>