<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.koscom.deny.dao.DenyMapper">
 	<select id="listDenyDetail" parameterType="com.koscom.deny.model.DenyVO" resultType="com.koscom.deny.model.DenyVO">
		SELECT MIN(TO_CHAR(DI.DT_FRT, 'YYYY-MM-DD HH24:MI')) DT_FRT,
		 A.NM_GOODS, A.YN_USE, A.CD_GOODS_TYPE, A.C20_GOODS_COMP
		,A.NM_FILECI, A.PATH_FILECI
		,GI.NO_PERSON,GI.NO_PREPARE,GI.CD_FC,GI.CD_GOODS
		,GI.YEAR_TERM
		,GI.AMT_PMT
		,GI.RTO_LOAN
		,GI.AMT_LOAN_INDEX
		,GI.RTO_DTI
		,GI.AMT_LIMIT
		,DI.DENY_DESC
		FROM FINCOOK_GOODS_INFO GI, FINCOOK_DENY_INFO DI, GOODS_INFO A
		WHERE 1=1
		AND A.YN_USE = 'Y'    
		AND GI.NO_PERSON     = DI.NO_PERSON    
		AND GI.NO_PREPARE    = DI.NO_PREPARE   
		AND GI.CD_FC = DI.CD_FC
		AND GI.CD_GOODS      = DI.CD_GOODS     
		AND GI.CD_GOODS      = A.CD_GOODS
		AND GI.CD_FC = A.CD_FC
		AND GI.NO_PERSON     = #{no_person  , jdbcType=VARCHAR}<!-- 'P000008558' -->
		<if test='@com.koscom.util.MybatisUtil@isNotEmpty(no_prepare)'>
			AND GI.NO_PREPARE    = #{no_prepare    , jdbcType=VARCHAR}<!-- '000000006304' -->
		</if>
     	<if test='@com.koscom.util.MybatisUtil@isNotEmpty(cd_fc)'>
			AND GI.cd_fc = #{cd_fc , jdbcType=VARCHAR}
		</if>
     	<if test='@com.koscom.util.MybatisUtil@isNotEmpty(cd_goods)'>
			AND GI.cd_goods = #{cd_goods , jdbcType=VARCHAR}
		</if>
		
		group by
		 A.NM_GOODS, A.YN_USE, A.CD_GOODS_TYPE, A.C20_GOODS_COMP
		,A.NM_FILECI, A.PATH_FILECI
		,GI.NO_PERSON,GI.NO_PREPARE,GI.CD_FC,GI.CD_GOODS
		,GI.YEAR_TERM
		,GI.AMT_PMT
		,GI.RTO_LOAN
		,GI.AMT_LOAN_INDEX
		,GI.RTO_DTI
		,GI.AMT_LIMIT
		,DI.DENY_DESC
		
		
		
		ORDER BY GI.NO_PREPARE DESC, GI.CD_FC, GI.CD_GOODS, GI.YEAR_TERM
	</select>
</mapper>